syntax = "proto3";

import "google/protobuf/timestamp.proto";

enum MetricType {
  Tcp = 0;
  Nic = 1;
}

// from linux/include/net/tcp_states.h
enum SocketState {
  TCP_ESTABLISHED = 0;
  TCP_SYN_SENT = 1;
  TCP_SYN_RECV = 2;
  TCP_FIN_WAIT1 = 3;
  TCP_FIN_WAIT2 = 4;
  TCP_TIME_WAIT = 5;
  TCP_CLOSE = 6;
  TCP_CLOSE_WAIT = 7;
  TCP_LAST_ACK = 8;
  TCP_LISTEN = 9;
  TCP_CLOSING = 10;
  TCP_NEW_SYN_RECV = 11;
}

message SocketMetric {
  SocketState state = 3;
  uint32 RecvQ = 4;
  uint32 SendQ = 5;
  string LocalAddr = 6;
  string PeerAddr = 7;
}

message TcpMetric {
  // header
  google.protobuf.Timestamp Timestamp = 1;
  MetricType type = 2;
  repeated SocketMetric sockets = 3;
}

message IfaceMetric {
  string Name = 1;
  uint32 RXErrors = 2;
  uint32 RXDropped = 3;
  uint32 RXOverruns = 4;
  uint32 RXFrame = 5;
  uint32 TXErrors = 6;
  uint32 TXDropped = 7;
  uint32 TXOverruns = 8;
  uint32 TXCarrier = 9;
  uint32 TXCollisions = 10;
}

message NicMetric {
  // header
  google.protobuf.Timestamp Timestamp = 1;
  MetricType type = 2;
  // fields
  repeated IfaceMetric ifaces = 3;
}

message NetstatMetric {
  uint32 ip_total_packets_received = 1;
	uint32 ip_forwarded = 2;
	uint32 ip_incoming_packets_discarded = 3;
	uint32 ip_incoming_packets_delivered = 4;
	uint32 ip_requests_sent_out = 5;
	uint32 ip_outgoing_packets_dropped = 6;

	uint32 tcp_active_connections_openings = 7;
	uint32 tcp_passive_connection_openings = 8;
	uint32 tcp_failed_connection_attempts = 9;
	uint32 tcp_connection_resets_received = 10;
	uint32 tcp_connections_established = 11;
	uint32 tcp_segments_received = 12;
	uint32 tcp_segments_send_out = 13;
	uint32 tcp_segments_retransmited = 14;
	uint32 tcp_bad_segments_received = 15;
	uint32 tcp_resets_sent = 16;

	uint32 udp_packets_received = 17;
	uint32 udp_packets_to_unknown_port_received = 18;
	uint32 udp_packet_receive_errors = 19;
	uint32 udp_packets_sent = 20;
	uint32 udp_receive_buffer_errors = 21;
	uint32 udp_send_buffer_errors = 22;
}