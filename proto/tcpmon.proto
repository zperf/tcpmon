syntax = "proto3";

import "google/protobuf/timestamp.proto";

enum MetricType {
  TCP = 0;
  NIC = 1;
}

// from linux/include/net/tcp_states.h
enum SocketState {
  TCP_ESTABLISHED = 0;
  TCP_SYN_SENT = 1;
  TCP_SYN_RECV = 2;
  TCP_FIN_WAIT1 = 3;
  TCP_FIN_WAIT2 = 4;
  TCP_TIME_WAIT = 5;
  TCP_CLOSE = 6;
  TCP_CLOSE_WAIT = 7;
  TCP_LAST_ACK = 8;
  TCP_LISTEN = 9;
  TCP_CLOSING = 10;
  TCP_NEW_SYN_RECV = 11;
}

message SocketMetric {
  SocketState state = 3;
  uint32 recv_q = 4;
  uint32 send_q = 5;
  string local_addr = 6;
  string peer_addr = 7;
}

message TcpMetric {
  // header
  google.protobuf.Timestamp timestamp = 1;
  MetricType type = 2;
  // fields
  repeated SocketMetric sockets = 3;
}

message IfaceMetric {
  string name = 1;
  uint32 rx_errors = 2;
  uint32 rx_dropped = 3;
  uint32 rx_overruns = 4;
  uint32 rx_frame = 5;
  uint32 tx_errors = 6;
  uint32 tx_dropped = 7;
  uint32 tx_overruns = 8;
  uint32 tx_carrier = 9;
  uint32 tx_collisions = 10;
}

message NicMetric {
  // header
  google.protobuf.Timestamp timestamp = 1;
  MetricType type = 2;
  // fields
  repeated IfaceMetric ifaces = 3;
}
